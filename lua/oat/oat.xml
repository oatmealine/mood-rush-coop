<Mods LoadCommand="%xero(function(self)
	-- wenis times (setup)

	oat_randomvert:hidden(1)
	oat_postsprite:SetTexture(oat_postaft:GetTexture())
	
	-- util funcs
	function table.contains(table, element)
		for _, value in pairs(table) do
			if value == element then
				return true
			end
		end
		return false
	end

	local function reverseRotation(angleX, angleY, angleZ)
		local DEG_TO_RAD = math.pi / 180
		angleX, angleY, angleZ = DEG_TO_RAD * angleX, DEG_TO_RAD * angleY, DEG_TO_RAD * angleZ
		local sinX = math.sin(angleX);
		local cosX = math.cos(angleX);
		local sinY = math.sin(angleY);
		local cosY = math.cos(angleY);
		local sinZ = math.sin(angleZ);
		local cosZ = math.cos(angleZ);
		return 100 * math.atan2(-cosX*sinY*sinZ-sinX*cosZ,cosX*cosY), 100 * math.asin(-cosX*sinY*cosZ+sinX*sinZ), 100 * math.atan2(-sinX*sinY*cosZ-cosX*sinZ,cosY*cosZ)
	end

	local function confOff(deg)
		return math.rad(deg) * 100
	end

	local function mix(a, b, x)
		return a * (1 - x) + b * x
	end

	local randomVert = oat_randomvert:GetShader()

	local function enableVert(shader, players)
		players = players or {1, 2, 3, 4}

		for _,p in ipairs(players) do
			P[p]:SetArrowShader(shader)
			P[p]:SetHoldShader(shader)
		end
	end

	local function disableVert()
		enableVert('nothing') -- no other way ..... ha ha
	end

	local function enableRandVert(players)
		enableVert(randomVert, players)
	end

	local slump = GAMESTATE:GetCurrentSteps(0):GetDifficulty() == 5

	local function wrap(a)
		return function() end
	end

	-- eases
	local function onoff(x)
		return (x >= 1) and 0 or 1
	end

	local function reverse(x)
		return 1 - x
	end

	local function createReverse(func)
		return function(x)
			return 1 - func(x)
		end
	end

	local function createTemp(func)
		return function(x)
			if x > 0.999 then
				return 0
			end
			return func(x)
		end
	end

	local function bounc(a)
		if a < 0.5 then
			return outCirc(a/2)
		else
			return inCirc(a/2-1)
		end
	end

	-- custom modd de

	alias {'arrowfuck', function(a)
		randomVert:uniform1f('ampA', a)
	end}

	alias {'fuckarrow', function(a)
		randomVert:uniform1f('ampB', a)
	end}

	alias {'stealth2', function(a)
		randomVert:uniform1f('stealth', a)
	end}

	alias {'glitch2', function(a)
		oat_postsprite:GetShader():uniform1f('amount', a)
	end}

	-- The Real wenis times

	func {179, wrap(enableRandVert({1}))}

	ease {179, 1, outCirc, 90, 'stealth', -60, 'flip', 200, 'drunky', 400, 'tipsy', 700, 'drunk', 500, 'drunkz', 500, 'bumpyx', 100, 'dark', 100, 'boomerang', -100, 'zoom', 100, 'hidenoteflashes', plr = 2}
	ease {179, 1, outCirc, 50, 'tipsy', -10, 'flip', plr = 1}
	ease {180, 208-180, linear, 360 * 3, 'rotationy', confOff(-360 * 3), 'confusionyoffset', plr = 1}

	ease {204, 211-204, inOutSine, 100, 'reverse', -50, 'flip', 150, 'tipsy', plr = 1}

	func {211, 236-211, function(beat, poptions)
		local prog = (beat - 211) / (236 - 211)
		local anglex = mix(0, 360 * 3, prog)
		local angley = mix(360 * 3, 360 * 1, prog)

		local nx, ny, nz = reverseRotation(anglex, angley, 0)

		poptions[1].confusionxoffset = nx
		poptions[1].confusionyoffset = ny
	end}

	ease {211, 236-211, linear, 360 * 3, 'rotationx', 360 * 1, 'rotationy', plr = 1}
	ease {236, 4, outSine, 0, 'rotationx', 0, 'confusionxoffset'}

	ease {240, 3, inSine, 0, 'stealth', 0, 'flip', 0, 'drunky', 0, 'tipsy', 0, 'drunk', 0, 'drunkz', 0, 'bumpyx', 0, 'dark', 0, 'boomerang', 100, 'zoom', 0, 'hidenoteflashes', plr = 2}
	ease {240, 3, inSine, 0, 'rotationy', 0, 'confusionyoffset', 0, 'flip', 0, 'reverse', 0, 'tipsy', plr = 1}

	for i,b in ipairs(funihold) do
		local xory = ((i % 2) == 0) and 'x' or 'y'

		ease {b[1], 1 + (b[2] or 0) * 0.8, createReverse(outCirc), 0.5, 'glitch2', 0.4, 'arrowfuck', 0.4, 'fuckarrow', -170, 'tiny' .. xory, 160, 'tipsy'}
	end

	ease {244 - 2/3, 2/3 * 2, inOutCirc, 200, 'tipsy'}
	ease {244, 2/3 * 2, inOutCirc, -200, 'tipsy'}
	ease {245.5 - 0.5, 0.5 * 2, inOutCirc, 150, 'tipsy', 10, 'rotationz'}
	ease {246 - 0.5, 0.5 * 2, inOutCirc, -200, 'tipsy', -5, 'rotationz'}
	ease {246.5 - 0.5, 0.5 * 2, inOutCirc, 200, 'tipsy', 0, 'rotationz'}
	ease {247.5 - 0.5, 0.5 * 2, inOutCirc, -200, 'tipsy', 100, 'reverse'}
	ease {248 - 0.5, 0.5 * 2, inOutCirc, 150, 'tipsy', 0, 'reverse'}
	ease {247.5, 0.5, createReverse(outCirc), -50, 'tinyx'}
	ease {248, 0.5, createReverse(outCirc), -50, 'tinyy'}
	ease {248.5 - 2/3, 2/3 * 2, inOutCirc, -200, 'tipsy', -20, 'rotationz'}
	ease {249.167 - 2/3, 2/3 * 2, inOutCirc, 150, 'tipsy', 15, 'rotationz'}
	ease {249.833 - 0.5, 0.5 * 2, inOutCirc, -200, 'tipsy', -5, 'rotationz'}
	ease {250.75 - 0.5, 0.5 * 2, inOutCirc, 0, 'tipsy', 10, 'rotationz', 100, 'reverse'}
	ease {252 - 0.5, 0.5 * 2, inOutCirc, 0, 'rotationz', 0, 'reverse'}
end)"
	Type = "ActorFrame"
><children>

	<!-- sprites only made for shaders -->
	<Layer Type="Sprite" Texture="white" Vert="shaders/random.vert" Name="oat_randomvert"/>

	<!-- notedata -->
	<CODE File="funihold.xml"/>

	<!-- post-proc -->

	<Layer 
		Type = "ActorFrameTexture" 
		InitCommand = "%xero.aft" 
		Name = "oat_postaft" 
	/>
	<Layer 
		Type = "Sprite"
		Frag = "shaders/glitch2.frag"
		InitCommand = "%xero.sprite" 
		Name = "oat_postsprite" 
	/>

</children></Mods>
